<!DOCTYPE html>
<html lang="pl">
<!--
====================================================
    __  ____  ______________  _______ ___    __
   / / / /  |/  / ____/   \ \/ / ___//   |  / /
  / /_/ / /|_/ / /_  / /| |\  /\__ \/ /| | / /
 / __  / /  / / __/ / ___ |/ /___/ / ___ |/ /___
/_/ /_/_/  /_/_/   /_/  |_/_//____/_/  |_/_____/

====================================================
Owner Name: Hossain Mohammad Faysal
Profile: https://www.facebook.com/hmfaysal
Version: 1.1
Description: Awesome dude, awesome life
====================================================
-->
<head>
<meta charset='utf-8'>
<title>Refaktoring w Ruby krok po kroku - czÄ™Å›Ä‡ 2 - Woman on Rails - web development z kobiecej perspektywy</title>
<meta name="description" content="Jak zrobiÄ‡ refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.">
<meta name="keywords" content="Ruby">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://womanonrails.com/images/womanonrails-square.svg">
<meta name="twitter:title" content="Refaktoring w Ruby krok po kroku - czÄ™Å›Ä‡ 2">
<meta name="twitter:description" content="Jak zrobiÄ‡ refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.">
<meta name="twitter:creator" content="@womanonrails">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="Refaktoring w Ruby krok po kroku - czÄ™Å›Ä‡ 2">
<meta property="og:description" content="Jak zrobiÄ‡ refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.">
<meta property="og:image" content="https://womanonrails.com/images/womanonrails-1000x1000.jpg">

<link rel='shortcut icon' href="https://womanonrails.com/favicon.ico">
<link rel='shortcut icon' href="https://womanonrails.com/favicon.png">





<link rel="canonical" href="https://womanonrails.com/refactoring-part2">
<link href="https://womanonrails.com/feed.xml" type="application/atom+xml" rel="alternate" title="Woman on Rails Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Begin Jekyll SEO tag v2.6.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Refaktoring w Ruby krok po kroku - czÄ™Å›Ä‡ 2" />
<meta name="author" content="womanonrails" />
<meta property="og:locale" content="pl" />
<meta name="description" content="Jak zrobiÄ‡ refaktoring? Od kodu zorientowanego obiektowo do kompozycji." />
<meta property="og:description" content="Jak zrobiÄ‡ refaktoring? Od kodu zorientowanego obiektowo do kompozycji." />
<link rel="canonical" href="https://womanonrails.com/pl/refactoring-part2" />
<meta property="og:url" content="https://womanonrails.com/pl/refactoring-part2" />
<meta property="og:site_name" content="Woman on Rails" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-25T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Jak zrobiÄ‡ refaktoring? Od kodu zorientowanego obiektowo do kompozycji.","@type":"BlogPosting","url":"https://womanonrails.com/pl/refactoring-part2","headline":"Refaktoring w Ruby krok po kroku - czÄ™Å›Ä‡ 2","dateModified":"2018-11-25T00:00:00-05:00","datePublished":"2018-11-25T00:00:00-05:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://womanonrails.com/pl/womanonrails-square.svg"},"name":"womanonrails"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://womanonrails.com/pl/refactoring-part2"},"author":{"@type":"Person","name":"womanonrails"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" type="text/css" href="https://womanonrails.com/assets/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="https://womanonrails.com/assets/css/style.css" />
<link rel="stylesheet" href="/css/main.css">

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search...">
        <i class="icon-remove-sign"></i>
        <ul class="search-results post-list"></ul><!-- /.search-results -->
    </div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

</head>
<body class="post-template" itemscope itemtype="https://schema.org/WebPage">
<div id="fade"></div>
<a id="slide" class="animated fade"></a>
<aside id="sidebar">
  <nav id="navigation">
    <h2>MENU</h2>
    <hr>
    <ul>
      

<li>
  <a href="https://womanonrails.com/">Strona gÅ‚Ã³wna</a>
</li>


<li>
  <a href="https://womanonrails.com/pl/workshops">Kursy programowania</a>
</li>


<li>
  <a href="https://womanonrails.com/pl/categories">Kategorie</a>
</li>


<li>
  <a href="https://womanonrails.com/pl/tags">Tagi</a>
</li>


<li>
  <a href="https://womanonrails.com/pl/about">O mnie</a>
</li>


<li>
  <a href="https://bemore.womanonrails.com/">Be more</a>
</li>

<li>
  <a href="/pl/feed.xml" title='Atom/RSS feed'>
    <i class='icon-rss'></i> Feed
  </a>
</li>

    </ul>
  </nav>
</aside>


<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom" itemscope itemtype="https://schema.org/Organization">



<button class='menu-button animated fade dosearch' title='Wyszukaj'>
  <i class='icon-search'></i>
</button>



<a href="/refactoring-part2" class='language animated fade'>
  en
</a>


<div class='inner'>
  <div class='container'>
    <a class='brand' href='/pl' itemprop='url' role='banner'>
      
<img itemprop='logo' src="https://womanonrails.com/images/womanonrails-square.svg" alt="Woman on Rails Logo" width='120' />


      <h1 class='blog-title light' itemprop='name'>
        Woman on Rails
      </h1>
    </a>
    
    <h2 class='blog-description light bordered bordered-top' itemprop='description'>
      Premature optimization is the root of all evil.
    </h2>
    
  </div>
</div>



    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="https://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
            <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

            <path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path>
            <path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path>

            <path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path>
            <path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path>

            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>

</header>

<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="https://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
            
            
            
                    <header class="post-header entry-header">
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Refaktoring w Ruby krok po kroku - czÄ™Å›Ä‡ 2</h1>
                        
                        <div class="cursive" style="color: #000; font-style:italic;">Jak zrobiÄ‡ refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.</div>
                        <div class="post-info text-center small">
                          
                          
                          
                          <span class='post-tags'>

  <a data-toggle='tooltip'
     href="https://womanonrails.com/categories/index.html#refaktoring"
     title="Other posts from the Refaktoring category"
     rel="tag">Refaktoring</a>

</span>
|

                          



<!-- &nbsp; -->
<span class='post-tags reading-time'>
<!-- <i class='icon-time'></i> -->
<!-- ğŸ•°ï¸ -->
<!-- &nbsp; -->
<span class='time'>14</span> min.
</span>


                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <p>Ostatnim razem w artykule <a href="/pl/refactoring-step-by-step">Refactoring w Ruby krok po kroku - czÄ™Å›Ä‡ 1</a> przeszÅ‚yÅ›my od kodu proceduralnego do kodu bardziej zorientowanego obiektowo. Tym razem bÄ™dziemy kontynuowaÄ‡ naszÄ… podrÃ³Å¼ przez refaktoring. BÄ™dziemy mÃ³wiÄ‡ o maÅ‚ych obiektach zastÄ™pujÄ…cych duÅ¼e klasy, o kompozycji i o wstrzykiwaniu konkretnych zachowaÅ„ do obiektÃ³w. Zaczynajmy!</p>

<h1 id="krok-8---bardziej-opisowe-wyniki">Krok 8 - Bardziej opisowe wyniki</h1>

<p>Ten krok zaczynamy od <a href="https://github.com/womanonrails/poker/blob/46e12428d0d67cb90d17f417147dc936815a69e7/lib/poker/hand.rb" title="SiÃ³dmy krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">kodu</a> i skupimy siÄ™ na czytelnoÅ›ci tej metody:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="k">return</span> <span class="mi">9</span> <span class="k">if</span> <span class="n">straight_flush?</span>
  <span class="k">return</span> <span class="mi">8</span> <span class="k">if</span> <span class="n">four_of_a_kind?</span>
  <span class="k">return</span> <span class="mi">7</span> <span class="k">if</span> <span class="n">full_house?</span>
  <span class="k">return</span> <span class="mi">6</span> <span class="k">if</span> <span class="n">flush?</span>
  <span class="k">return</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">straight?</span>
  <span class="k">return</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">three_of_a_kind?</span>
  <span class="k">return</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">two_pair?</span>
  <span class="k">return</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">one_pair?</span>
  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">high_card?</span>
  <span class="k">return</span> <span class="mi">0</span>
<span class="k">end</span>
</code></pre></div></div>

<p>MuszÄ™ przyznaÄ‡, Å¼e to doÅ›Ä‡ waÅ¼ny krok. Kiedy myÅ›limy o czytelnoÅ›ci kodu o wiele Å‚atwiej zrozumieÄ‡ nam tekst <code class="highlighter-rouge">:straight_flush</code> niÅ¼ zwykÅ‚Ä… liczbÄ™ <code class="highlighter-rouge">9</code>. W przypadku tekstu nie musisz gÅ‚Ä™boko wchodziÄ‡ w szczegÃ³Å‚y implementacji kodu by wiedzieÄ‡, co on bÄ™dzie robiÅ‚. Z drugiej strony, podeszÅ‚am do tej zmiany doÅ›Ä‡ egoistycznie. MyÅ›laÅ‚am tylko o tej klasie bez zastanowienia nad konsekwencjami dla caÅ‚ego systemu. ZmieniÅ‚am to, co zwraca metoda <code class="highlighter-rouge">check</code>. W niektÃ³rych przypadkach taka zmiana moÅ¼e byÄ‡ bardzo trudna do wprowadzenia lub nawet niemoÅ¼liwa, przy bieÅ¼Ä…cym stanie kodu. W moim przypadku zmiana ta wymagaÅ‚a poprawy wszystkich testÃ³w. Dlatego musisz byÄ‡ ostroÅ¼na i Å›wiadoma przy wprowadzaniu takich zmian. W kaÅ¼dym razie, uwaÅ¼am Å¼e w moim przypadku zmiana byÅ‚a warta zachodu.</p>

<p>Kod po zmianie:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="k">return</span> <span class="ss">:straight_flush</span> <span class="k">if</span> <span class="n">straight_flush?</span>
  <span class="k">return</span> <span class="ss">:four_of_a_kind</span> <span class="k">if</span> <span class="n">four_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:full_house</span> <span class="k">if</span> <span class="n">full_house?</span>
  <span class="k">return</span> <span class="ss">:flush</span> <span class="k">if</span> <span class="n">flush?</span>
  <span class="k">return</span> <span class="ss">:straight</span> <span class="k">if</span> <span class="n">straight?</span>
  <span class="k">return</span> <span class="ss">:three_of_a_kind</span> <span class="k">if</span> <span class="n">three_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:two_pair</span> <span class="k">if</span> <span class="n">two_pair?</span>
  <span class="k">return</span> <span class="ss">:one_pair</span> <span class="k">if</span> <span class="n">one_pair?</span>
  <span class="k">return</span> <span class="ss">:high_card</span> <span class="k">if</span> <span class="n">high_card?</span>
  <span class="k">return</span> <span class="ss">:none</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NowÄ… wersjÄ™ kodu moÅ¼esz znaleÅºÄ‡ <a href="https://github.com/womanonrails/poker/blob/4896498a348db52d5c884a522a132eae5b2c4f60/lib/poker/hand.rb" title="Ã“smy krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a></p>

<h2 id="statystyki">Statystyki:</h2>
<ul>
  <li><strong>LOC</strong>  - 80</li>
  <li><strong>LOT</strong>  - 190</li>
  <li><strong>Flog</strong> - 62.5</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 104 examples, 0 failures</li>
</ul>

<h1 id="krok-9---meta-programowanie">Krok 9 - Meta-programowanie</h1>

<p>Ten krok jest caÅ‚kowicie opcjonalny. ZrobiÅ‚am go poniewaÅ¼ nie podobaÅ‚ mi siÄ™ wyglÄ…d metody <code class="highlighter-rouge">check</code> i te powtÃ³rzenia wewnÄ…trz. UwaÅ¼am, Å¼e po tej zmianie kod jest dalej czytelny, ale za to krÃ³tszy. Niestety nie zawsze tak jest. Czasem meta-programowanie bardzo pogarsza czytelnoÅ›Ä‡ kodu. Dlatego zawsze jako programistka Ty jesteÅ› odpowiedzialna za swÃ³j kod i to Ty musisz wybraÄ‡ rozwiÄ…zanie, ktÃ³re Twoim zadaniem jest lepsze. W moim przypadku stworzyÅ‚am tablicÄ™ z poprawnÄ… kolejnoÅ›ciÄ… sprawdzania rÄ™ki pokerowej i uÅ¼yÅ‚am jej w metodzie <code class="highlighter-rouge">check</code>.</p>

<p>Kod przed zmianÄ…:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="k">return</span> <span class="ss">:straight_flush</span> <span class="k">if</span> <span class="n">straight_flush?</span>
  <span class="k">return</span> <span class="ss">:four_of_a_kind</span> <span class="k">if</span> <span class="n">four_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:full_house</span> <span class="k">if</span> <span class="n">full_house?</span>
  <span class="k">return</span> <span class="ss">:flush</span> <span class="k">if</span> <span class="n">flush?</span>
  <span class="k">return</span> <span class="ss">:straight</span> <span class="k">if</span> <span class="n">straight?</span>
  <span class="k">return</span> <span class="ss">:three_of_a_kind</span> <span class="k">if</span> <span class="n">three_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:two_pair</span> <span class="k">if</span> <span class="n">two_pair?</span>
  <span class="k">return</span> <span class="ss">:one_pair</span> <span class="k">if</span> <span class="n">one_pair?</span>
  <span class="k">return</span> <span class="ss">:high_card</span> <span class="k">if</span> <span class="n">high_card?</span>
  <span class="k">return</span> <span class="ss">:none</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Kod po zmianie:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'?'</span><span class="p">).</span><span class="nf">to_sym</span>
    <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">send</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>gdzie <code class="highlighter-rouge">@order_checking</code> to tablica ustawieÅ„ rÄ™ki w pokerze.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@order_checking = [
  :straight_flush, :four_of_a_kind, :full_house, :flush, :straight,
  :three_of_a_kind, :two_pair, :one_pair, :high_card, :none
]
</code></pre></div></div>

<p>CaÅ‚y kod moÅ¼esz znaleÅºÄ‡ <a href="https://github.com/womanonrails/poker/blob/4d649a25af020c7f862b3c6ed964f1b2e73a0f60/lib/poker/hand.rb" title="DziewiÄ…ty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a></p>

<h2 id="statystyki-1">Statystyki</h2>
<ul>
  <li><strong>LOC</strong>  - 82</li>
  <li><strong>LOT</strong>  - 190</li>
  <li><strong>Flog</strong> - 59.3</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 104 examples, 0 failures</li>
</ul>

<h1 id="krok-10---maÅ‚e-obiekty">Krok 10 - MaÅ‚e obiekty</h1>

<p>Ten krok byÅ‚ doÅ›Ä‡ duÅ¼y ale rÃ³wnieÅ¼ waÅ¼ny. MoÅ¼e nawet najwaÅ¼niejszy. ZaczÄ™Å‚am od zasad <strong>SOLID</strong>. JeÅ›li nie sÅ‚yszaÅ‚aÅ› o tych zasadach lub chciaÅ‚abyÅ› szybko odÅ›wieÅ¼yÄ‡ sobie pamiÄ™Ä‡, to zajrzyj na <a href="https://pl.wikipedia.org/wiki/SOLID_(programowanie_obiektowe)" title="SOLID (programowanie obiektowe)" target="_blank" rel="nofollow noopener noreferrer">stronÄ™ Wiki</a>. Polecam teÅ¼ prezentacjÄ™ <a href="https://www.youtube.com/watch?v=v-2yFMzxqwU" title="Sandy Metz - SOLID Object-Oriented Design" target="_blank" rel="nofollow noopener noreferrer">Sandy Metz - SOLID Object-Oriented Design</a>. ZaczÄ™Å‚am od <strong>S - Single responsibility principle</strong> - zasady pojedynczej odpowiedzialnoÅ›ci. Kiedy popatrzysz na kod klasy <code class="highlighter-rouge">Hand</code>, stwierdzisz, Å¼e ta klasa wie i robi wszystko. Tak jak juÅ¼ mÃ³wiÅ‚am w poprzednim artykule ten kod jest bardziej proceduralny niÅ¼ obiektowy. ZaczÄ™Å‚am, wiÄ™c wyciÄ…gaÄ‡ funkcjonalnoÅ›ci jedna po drugiej. KaÅ¼dy etap byÅ‚ doÅ›Ä‡ podobny do poprzedniego, dlatego pokaÅ¼Ä™ go na jednym przykÅ‚adzie. Na przykÅ‚adnie metody <code class="highlighter-rouge">four_of_a_kind</code>:</p>

<ul>
  <li>PrzeniosÅ‚am logikÄ™ metody <code class="highlighter-rouge">four_of_a_kind</code> do osobnej klasy. Tak, to wytworzy w kodzie pewne powtÃ³rzenia, ale jak mÃ³wi Sandi <em>duplication is better than a wrong abstraction</em> (powtÃ³rzenia sÄ… lepsze od zÅ‚ej abstrakcji).</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">FourOfAKind</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
      <span class="vi">@array</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">sort</span>
      <span class="vi">@figures</span><span class="p">,</span> <span class="vi">@colors</span> <span class="o">=</span> <span class="n">cards_figures_and_colors</span>
      <span class="vi">@frequency</span> <span class="o">=</span> <span class="n">cards_frequency</span><span class="p">.</span><span class="nf">values</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:four_of_a_kind</span> <span class="k">if</span> <span class="vi">@frequency</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">cards_figures_and_colors</span>
      <span class="vi">@array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="p">[</span><span class="n">item</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">item</span> <span class="o">%</span> <span class="mi">4</span><span class="p">]</span> <span class="p">}.</span><span class="nf">transpose</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">cards_frequency</span>
      <span class="vi">@figures</span><span class="p">.</span><span class="nf">each_with_object</span><span class="p">(</span><span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="nb">hash</span><span class="o">|</span>
        <span class="nb">hash</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li>TworzÄ™ a w pÃ³Åºniejszych krokach modyfikujÄ™ brzydko wyglÄ…dajÄ…cy warunek <code class="highlighter-rouge">if</code> w klasie <code class="highlighter-rouge">Hand</code> tak by obsÅ‚uÅ¼yÅ‚ on nowy kod.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="k">if</span> <span class="nb">name</span> <span class="o">==</span> <span class="ss">:four_of_a_kind</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="no">FourOfAKind</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
    <span class="k">else</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'?'</span><span class="p">).</span><span class="nf">to_sym</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">send</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li>PrzygotowujÄ™ testy dla nowej klasy. Tak, powieliÅ‚am juÅ¼ istniejÄ…ce testy dla metody <code class="highlighter-rouge">check</code> w tej nowej klasie. Na tÄ… chwilÄ™ musi to tak zostaÄ‡.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="no">Poker</span><span class="o">::</span><span class="no">FourOfAKind</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span>
  <span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">cards</span><span class="o">|</span>
    <span class="n">it</span> <span class="s2">"detects four_of_a_kind for </span><span class="si">#{</span><span class="n">cards</span><span class="si">}</span><span class="s2">"</span> <span class="k">do</span>
      <span class="n">hand</span> <span class="o">=</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">cards</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">hand</span><span class="p">.</span><span class="nf">check</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="ss">:four_of_a_kind</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Podczas tego procesu zrobiÅ‚am jeszcze jednÄ… rzecz. WstrzyknÄ™Å‚am kolejnoÅ›Ä‡ sprawdzania rÄ™ki pokerowej do inicjalizera klasy <code class="highlighter-rouge">Hand</code>. <code class="highlighter-rouge">ORDER_CHECKING</code> to staÅ‚a, ktÃ³rÄ… moÅ¼na traktowaÄ‡ jako konfiguracjÄ™ i wyciÄ…gnÄ…Ä‡ do osobnego pliku jeÅ¼eli zajdzie taka potrzeba. ZrobiÅ‚am to na wypadek gdybym chciaÅ‚a szybko zmieniÄ‡ kolejnoÅ›Ä‡ sprawdzania tego, co gracz ma w rÄ™ce w testach lub w aplikacji.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">order_checking</span> <span class="o">=</span> <span class="no">ORDER_CHECKING</span><span class="p">)</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Kod dla tego etapu znajdziesz <a href="https://github.com/womanonrails/poker/tree/0c5d6850d40f899d98ff531e4a2b948d469c3d84/lib/poker" title="DziesiÄ…ty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. ZostaÅ‚ on powtÃ³rzony przeze mnie dla kaÅ¼dej rÄ™ki pokerowej. Po kaÅ¼dej iteracji wszystkie testy przechodziÅ‚y. JeÅ¼eli chciaÅ‚abyÅ› zobaczyÄ‡ jak to wyglÄ…da z wiÄ™kszej perspektywy, to zajrzyj <a href="https://github.com/womanonrails/poker/tree/08631288c747a2a9fda3d986f4046e9e363ea027/lib/poker" title="3 klasy stworzone na bazie powyÅ¼szych krokÃ³w" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. W tym miejscu istniejÄ… juÅ¼ 3 klasy stworzone na bazie powyÅ¼szych krokÃ³w.</p>

<h2 id="statystyki-2">Statystyki</h2>
<ul>
  <li><strong>LOC</strong>  - 85</li>
  <li><strong>LOT</strong>  - 200</li>
  <li><strong>Flog</strong> - 65.5</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 116 examples, 0 failures</li>
</ul>

<h1 id="krok-11---usuwanie-powieleÅ„">Krok 11 - Usuwanie powieleÅ„</h1>

<p>W tym kroku zajÄ™Å‚am siÄ™ usuwaniem analogii w kodzie. A muszÄ™ przyznaÄ‡, Å¼e byÅ‚o tego doÅ›Ä‡ sporo. Za kaÅ¼dym razem przy tworzeniu nowej klasy zmieniaÅ‚am tylko dwie rzeczy: nazwÄ™ klasy i jednÄ… liniÄ™ w metodzie <code class="highlighter-rouge">check</code>. By pozbyÄ‡ siÄ™ tego powielenia, musiaÅ‚am wydzieliÄ‡ jakieÅ› zachowanie, moÅ¼e metodÄ™ lub nawet klasÄ™, ktÃ³ra zajmie siÄ™ pewnego rodzaju sortowaniem kart i bÄ™dzie miaÅ‚a wiedzÄ™ na temat kolorÃ³w i figur. ZdecydowaÅ‚am, Å¼e stworzÄ™ normalizacjÄ™ kart. DziÄ™ki temu powstaÅ‚a klasa <code class="highlighter-rouge">CardsNormalization</code>, ktÃ³ra jest pewnego rodzaju reprezentacjÄ… doÅ›Ä‡ ogÃ³lnej klasy <code class="highlighter-rouge">Normalization</code>. MoÅ¼esz zapytaÄ‡ mnie dlaczego stworzyÅ‚am 2 klasy, kiedy potrzebuje tylko jednÄ…? No cÃ³Å¼, mam przeczucie, Å¼e tworzÄ™ maÅ‚y interfejs, ktÃ³ry bÄ™dzie miaÅ‚ wiele rÃ³Å¼nych reprezentacji. Na tÄ… chwilÄ™ istnieje tylko jedna reprezentacja, ale kto wie, co bÄ™dzie w przyszÅ‚oÅ›ci? PrzykÅ‚adem innej reprezentacji (innej normalizacji) jest gra w koÅ›ci. Zasady sÄ… bardzo podobne, ale normalizacja wprowadzanych danych bÄ™dzie wyglÄ…daÄ‡ inaczej. Kod tych dwÃ³ch nowych klas znajdziesz <a href="https://github.com/womanonrails/poker/tree/a668a538cb86dd17e946157c5d62373fe2266c0e/lib" title="Jedenasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. Kod ktÃ³ry byÅ‚ powielony w nowych klasach znalazÅ‚ siÄ™ w klasie <code class="highlighter-rouge">Normalization</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Normalization</span>
  <span class="nb">attr_reader</span> <span class="ss">:figures</span><span class="p">,</span> <span class="ss">:colors</span><span class="p">,</span> <span class="ss">:figures_frequency</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="vi">@array</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">sort</span>
    <span class="vi">@figures</span> <span class="o">=</span> <span class="n">prepare_figures</span>
    <span class="vi">@colors</span> <span class="o">=</span> <span class="n">prepare_colors</span>
    <span class="vi">@figures_frequency</span> <span class="o">=</span> <span class="n">prepare_figures_frequency</span><span class="p">.</span><span class="nf">values</span>
  <span class="k">end</span>
  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">prepare_colors</span>
    <span class="vi">@array</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">prepare_figures</span>
    <span class="vi">@array</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">prepare_figures_frequency</span>
    <span class="vi">@figures</span><span class="p">.</span><span class="nf">each_with_object</span><span class="p">(</span><span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="nb">hash</span><span class="o">|</span>
      <span class="nb">hash</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>a tutaj klasa <code class="highlighter-rouge">CardsNormalization</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CardsNormalization</span> <span class="o">&lt;</span> <span class="no">Normalization</span>
  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">prepare_colors</span>
    <span class="vi">@array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span> <span class="o">%</span> <span class="mi">4</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">prepare_figures</span>
    <span class="vi">@array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span> <span class="o">/</span> <span class="mi">4</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Podczas tego kroku zrobiÅ‚am jeszcze jednÄ… rzecz. WstrzyknÄ™Å‚am normalizacjÄ™ jako argument do inicjalizera klasy <code class="highlighter-rouge">Hand</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">order_checking</span> <span class="o">=</span> <span class="no">ORDER_CHECKING</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">CardsNormalization</span><span class="p">)</span>
</code></pre></div></div>

<p>Po tych wszystkich zmianach moja klasa <code class="highlighter-rouge">OnePair</code> wyglÄ…da nastÄ™pujÄ…co:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">OnePair</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
      <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:one_pair</span> <span class="k">if</span> <span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Tylko jedna metoda wyglÄ…da okropnie. To metoda <code class="highlighter-rouge">check</code>. Posiada ona teraz wiele warunkÃ³w. Wiem jednak, Å¼e jest to stan przejÅ›ciowy. ZajmÄ™ siÄ™ tÄ… metodÄ…, jak tylko zakoÅ„czÄ™ wyciÄ…ganie kolejnych funkcjonalnoÅ›ci z klasy <code class="highlighter-rouge">Hand</code>. Na tÄ… chwilÄ™ metoda ta wyglÄ…da tak:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="k">if</span> <span class="p">[</span><span class="ss">:one_pair</span><span class="p">].</span><span class="nf">include?</span> <span class="nb">name</span>
      <span class="n">class_name</span>  <span class="o">=</span> <span class="s1">'Poker::'</span> <span class="o">+</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'_'</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">).</span><span class="nf">join</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">class_name</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">,</span> <span class="vi">@normalization</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="p">[</span><span class="ss">:four_of_a_kind</span><span class="p">,</span> <span class="ss">:three_of_a_kind</span><span class="p">,</span> <span class="ss">:one_pair</span><span class="p">].</span><span class="nf">include?</span> <span class="nb">name</span>
      <span class="n">class_name</span>  <span class="o">=</span> <span class="s1">'Poker::'</span> <span class="o">+</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'_'</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">).</span><span class="nf">join</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">class_name</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
    <span class="k">else</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'?'</span><span class="p">).</span><span class="nf">to_sym</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">send</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NastÄ™pnie, powtÃ³rzyÅ‚am to samo rozumowanie dla reszty istniejÄ…cych klas. UÅ¼yÅ‚am <code class="highlighter-rouge">CardsNormalization</code> dla <code class="highlighter-rouge">FourOfAKind</code> i <code class="highlighter-rouge">ThreeOfAKind</code>. Kod znajdziesz <a href="https://github.com/womanonrails/poker/tree/87891306fe875bd415554a6eb5ebc0b46f893c9d/lib/poker" title="Kod po jedenastym kroku refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p>

<h2 id="statystyki-3">Statystyki:</h2>
<ul>
  <li><strong>LOC</strong>  - 87</li>
  <li><strong>LOT</strong>  - 200</li>
  <li><strong>Flog</strong> - 82.5</li>
  <li><strong>Flog total</strong> - 122.4</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 124 examples, 0 failures</li>
</ul>

<h1 id="krok-12---usuniÄ™cie-kolejnych-powtÃ³rzeÅ„">Krok 12 - UsuniÄ™cie kolejnych powtÃ³rzeÅ„</h1>

<p>Tym razem skupiÅ‚am siÄ™ na innych powtÃ³rzeniach w nowych klasach. W kilku miejscach sprawdzam podobny warunek: <code class="highlighter-rouge">@normalize_array.figures_frequency.include?(4)</code> zmienia siÄ™ tylko liczba. Jest to dla mnie pewnego rodzaju <em>zasada</em>. Sprawdzamy czy w kartach mamy 2, 3, lub 4 te same figury. ZdecydowaÅ‚am, Å¼e stworzÄ™ klasÄ™ <code class="highlighter-rouge">FrequencyRule</code> a tak wyglÄ…da jej kod:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Rules</span>
  <span class="k">class</span> <span class="nc">FrequencyRule</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
      <span class="vi">@frequency_array</span> <span class="o">=</span> <span class="n">frequency_array</span>
      <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check?</span>
      <span class="vi">@frequency_array</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="vi">@count</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>nastÄ™pnie dodaÅ‚am <code class="highlighter-rouge">@rule = Rules::FrequencyRule.new(@normalize_array.figures_frequency, 3)</code> do inicjalizera i uÅ¼yÅ‚am metody <code class="highlighter-rouge">@rule.check?</code> zamiast <code class="highlighter-rouge">@normalize_array.figures_frequency.include?(3)</code>. Tak wyglÄ…da klasa <code class="highlighter-rouge">ThreeOfAKind</code> po tej zmianie:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ThreeOfAKind</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
    <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="vi">@rule</span> <span class="o">=</span> <span class="no">Rules</span><span class="o">::</span><span class="no">FrequencyRule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">check</span>
    <span class="ss">:three_of_a_kind</span> <span class="k">if</span> <span class="vi">@rule</span><span class="p">.</span><span class="nf">check?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>CaÅ‚y kod wyglÄ…da <a href="https://github.com/womanonrails/poker/tree/d66590842ef194a9218dea70ccd083212b5d43b2/lib" title="Dwunasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tak</a>. Po tej zmianie i napisaniu nowych testÃ³w, wszystkie nowe i stare testy przechodzÄ….</p>

<h2 id="statystyki-4">Statystyki</h2>
<ul>
  <li><strong>LOC</strong>  - 87</li>
  <li><strong>LOT</strong>  - 161</li>
  <li><strong>Flog</strong> - 82.5</li>
  <li><strong>Flog total</strong> - 134.9</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 95 examples, 0 failures</li>
</ul>

<h1 id="krok-13---Å‚Ä…czenie-wielu-zasad">Krok 13 - ÅÄ…czenie wielu zasad</h1>

<p>Teraz interesujÄ…ca sprawa. Czas na fula. W tym przypadku potrzebujemy sprawdziÄ‡ czy mamy 3 i 2 te same figury w tym samym czasie. Tak jak tutaj: 2â™  2â™£ <span class="red-text">2â™¥ 3â™¥ 3â™¦</span>. Musimy wiÄ™c sprawdziÄ‡ tÄ… samÄ… zasadÄ™ dla dwÃ³ch i trzech tych samych figur. To dobry czas by stworzyÄ‡ klasÄ™, ktÃ³ra bÄ™dzie Å‚Ä…czyÄ‡ wiele rÃ³Å¼nych zasad. NazwaÅ‚am jÄ… <code class="highlighter-rouge">RulesFactory</code>. Kod wyglÄ…da nastÄ™pujÄ…co:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RulesFactory</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">rules</span><span class="p">)</span>
    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">rules</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">check?</span>
    <span class="vi">@rules</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">rule</span><span class="o">|</span>
      <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">rule</span><span class="p">.</span><span class="nf">check?</span>
    <span class="k">end</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A tak wyglÄ…da kod klasy <code class="highlighter-rouge">FullHouse</code> (karety):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">FullHouse</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
      <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
      <span class="n">rule1</span> <span class="o">=</span> <span class="no">Rules</span><span class="o">::</span><span class="no">FrequencyRule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">rule2</span> <span class="o">=</span> <span class="no">Rules</span><span class="o">::</span><span class="no">FrequencyRule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
      <span class="vi">@rules</span> <span class="o">=</span> <span class="no">RulesFactory</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">rule1</span><span class="p">,</span> <span class="n">rule2</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:full_house</span> <span class="k">if</span> <span class="vi">@rules</span><span class="p">.</span><span class="nf">check?</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Widzisz schemat? OczywiÅ›cie, trzeba jeszcze zrobiÄ‡ parÄ™ ulepszeÅ„ w klasie <code class="highlighter-rouge">Hand</code>. DopisaÄ‡ nowe testy i sprawdziÄ‡ czy przechodzÄ…. CaÅ‚y kod jest dostÄ™pny <a href="https://github.com/womanonrails/poker/tree/d18cf1f273c9fdcb97e21067d3411938beefdf36/lib" title="Trzynasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p>

<h1 id="krok-14---powtarzanie-krokÃ³w">Krok 14 - Powtarzanie krokÃ³w</h1>

<p>NadszedÅ‚ czas by powtÃ³rzyÄ‡ krok, ktÃ³ry juÅ¼ wczeÅ›niej opisaÅ‚am. Tworzymy nowe zasady: <code class="highlighter-rouge">StraightnessRule</code>, <code class="highlighter-rouge">FlushnessRule</code> i <code class="highlighter-rouge">RoyalnessRule</code>. Tworzymy nowe klasy: <code class="highlighter-rouge">Straight</code>, <code class="highlighter-rouge">Flush</code> i <code class="highlighter-rouge">RoyalFlush</code>. Kod po tej zmianie znajduje siÄ™ <a href="https://github.com/womanonrails/poker/tree/0985c071c87de56c8c49307d6d20963aced7ff79/lib" title="Czternasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p>

<p>ChciaÅ‚abym wspomnieÄ‡ o jednej magicznej sprawie. Kiedy zaczÄ™Å‚am tworzyÄ‡ maÅ‚e klasy z pojedyÅ„czymi odpowiedzialnoÅ›ciami, klasy te staÅ‚y siÄ™ w doÅ›Ä‡ proste. DziÄ™ki temu moÅ¼na uÅ¼ywaÄ‡ ich w nieoczekiwany sposÃ³b. Oto przykÅ‚ad:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Rules</span>
  <span class="k">class</span> <span class="nc">FlushnessRule</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">color_array</span><span class="p">)</span>
      <span class="vi">@color_array</span> <span class="o">=</span> <span class="n">color_array</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">check?</span>
      <span class="vi">@color_array</span><span class="p">.</span><span class="nf">uniq</span><span class="p">.</span><span class="nf">size</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To co klasa powinna robiÄ‡:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rule</span> <span class="o">=</span> <span class="no">FlushnessRule</span><span class="p">.</span><span class="nf">new</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;FlushnessRule:0x00000001eced60 @color_array=[1, 1]&gt;</span>
<span class="n">rule</span><span class="p">.</span><span class="nf">check?</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div>

<p>to co moÅ¼e robiÄ‡:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rule</span> <span class="o">=</span> <span class="no">FlushnessRule</span><span class="p">.</span><span class="nf">new</span><span class="p">([</span><span class="s1">'#fff'</span><span class="p">,</span><span class="s1">'#fff'</span><span class="p">])</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;FlushnessRule:0x00000001ebc020 @color_array=["#fff", "#fff"]&gt;</span>
<span class="n">rule</span><span class="p">.</span><span class="nf">check?</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div>

<p>Kiedy tworzyÅ‚am tÄ… klasÄ™ nie przypuszczaÅ‚am, Å¼e bÄ™dÄ™ mogÅ‚a jÄ… wykorzystaÄ‡ w taki sposÃ³b. Nie myÅ›laÅ‚am, Å¼e bÄ™dzie siÄ™ ona nadawaÄ‡ do obsÅ‚ugi zarÃ³wno tablic jak i ciÄ…gÃ³w znakÃ³w. Wiem, Å¼e to poniekÄ…d jest to zasÅ‚uga samego jÄ™zyka Ruby i jego <a href="https://pl.wikipedia.org/wiki/Duck_typing" title="Duck typing in Ruby" target="_blank" rel="nofollow noopener noreferrer"><strong>duck typingâ€™u</strong></a> ale myÅ›lÄ™, Å¼e teÅ¼ prostoty kodu.</p>

<h2 id="statystyki-5">Statystyki:</h2>
<ul>
  <li><strong>LOC</strong>  - 94</li>
  <li><strong>LOT</strong>  - 171</li>
  <li><strong>Flog</strong> - 69.7</li>
  <li><strong>Flog total</strong> - 191.2</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 142 examples, 0 failures</li>
</ul>

<h1 id="krok-15---zasada-dla-niczego">Krok 15 - Zasada dla Niczego</h1>

<p>Kiedy grasz w pokera moÅ¼esz mieÄ‡ w rÄ™ce jedno z punktowanych ustawieÅ„ figur lub po prostu nic. To â€œnicâ€ trzeba obsÅ‚uÅ¼yÄ‡ w kodzie. StworzyÅ‚am wiÄ™c klasÄ™ dla â€œniczegoâ€ - <code class="highlighter-rouge">None</code>. Dodatkowo zrobiÅ‚am teÅ¼ trochÄ™ porzÄ…dkÃ³w w klasie <code class="highlighter-rouge">Hand</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">None</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
      <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:none</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>CaÅ‚y kod zwiÄ…zany z tym krokiem znajdziesz <a href="https://github.com/womanonrails/poker/tree/03a356a42afed39fffd98ceff0b7b1311f7b05ec/lib" title="PiÄ™tnasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. Jak zawsze wszystkie testy po tym kroku przechodzÄ….</p>

<h2 id="statystyki-6">Statystyki</h2>
<ul>
  <li><strong>LOC</strong>  - 55</li>
  <li><strong>LOT</strong>  - 171</li>
  <li><strong>Flog</strong> - 56.0</li>
  <li><strong>Flog total</strong> - 180.8</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 145 examples, 0 failures</li>
</ul>

<h1 id="krok-16---multifrequencyrule">Krok 16 - MultiFrequencyRule</h1>

<p>To bÄ™dzie nasz ostatni krok. MoÅ¼esz wierzyÄ‡ lub nie ale najtrudniejsza do sprawdzenia zasada to dwie pary. Do tej pory stworzyÅ‚yÅ›my zasadÄ™ do sprawdzania liczby tych samych figur w rÄ™ce - <code class="highlighter-rouge">FrequencyRule</code>. Ta zasada jednak tu nie zadziaÅ‚a, poniewaÅ¼ chcemy sprawdziÄ‡ czy mamy 2 pary. Musimy wiÄ™c stworzyÄ‡ innÄ… zasadÄ™, innÄ… logikÄ™. PostanowiÅ‚am nazwaÄ‡ jÄ… <code class="highlighter-rouge">MultiFrequencyRule</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Rules</span>
  <span class="k">class</span> <span class="nc">MultiFrequencyRule</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
      <span class="vi">@frequency_array</span> <span class="o">=</span> <span class="n">frequency_array</span>
      <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
      <span class="vi">@times</span> <span class="o">=</span> <span class="n">times</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check?</span>
      <span class="n">selected_frequency</span> <span class="o">=</span> <span class="vi">@frequency_array</span><span class="p">.</span><span class="nf">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="vi">@count</span> <span class="p">}</span>
      <span class="n">selected_frequency</span><span class="p">.</span><span class="nf">count</span> <span class="o">&gt;=</span> <span class="vi">@times</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Tym razem sprawdzamy tylko wybranÄ… liczbÄ™ wystÄ…pieÅ„ w <code class="highlighter-rouge">@frequency_array</code>. Ile razy ona pojawia siÄ™ w tej tablicy. Chwila! JeÅ¼eli mamy takÄ… kombinacjÄ™ kart 2â™  2â™£ <span class="red-text">2â™¥ 3â™¥ 3â™¦</span> mamy w rÄ™ce fula ale rÃ³wnieÅ¼ dwie pary. Zasada do sprawdzania czy mamy w naszej rÄ™ce dwie pary teÅ¼ powinna zwrÃ³ciÄ‡ <code class="highlighter-rouge">true</code>. Dlatego teÅ¼ sprawdzamy warunek: <code class="highlighter-rouge">number &lt; @count</code> i usuwamy te elementy z tablicy. Kod dla tego kroku znajdziesz <a href="https://github.com/womanonrails/poker/blob/6a3af1c900c88477097ac00d405fef59866eb06b/lib/rules/multi_frequency_rule.rb" title="Kod klasy MultiFrequencyRule" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p>

<p><strong>Uwaga!</strong> JeÅ¼eli przyjrzysz siÄ™ bliÅ¼ej, to zauwaÅ¼ysz, Å¼e ten kod ma pewien problem. Przy ustawieniu 2â™  2â™£ <span class="red-text">2â™¥ 2â™¦ 3â™¥</span> teÅ¼ mamy dwie pary. Zmodyfikujmy naszÄ… metodÄ™ <code class="highlighter-rouge">check?</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check?</span>
  <span class="n">selected_frequency</span> <span class="o">=</span> <span class="vi">@frequency_array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span> <span class="o">/</span> <span class="vi">@count</span> <span class="p">}</span>
  <span class="n">selected_frequency</span><span class="p">.</span><span class="nf">sum</span> <span class="o">&gt;=</span> <span class="vi">@times</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Nareszcie moÅ¼emy caÅ‚kowicie wyczyÅ›ciÄ‡ logikÄ™ klasy <code class="highlighter-rouge">Hand</code>. MoÅ¼emy teÅ¼ zastÄ…piÄ‡ klasÄ™ <code class="highlighter-rouge">FrequencyRule</code>, klasÄ… <code class="highlighter-rouge">MultiFrequencyRule</code>, ktÃ³ra jest bardziej ogÃ³lna. Kod znajdziesz <a href="https://github.com/womanonrails/poker/tree/277d2893ffac1318c2a64fca2704e1c8258856e1/lib" title="Szesnasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. SprawdÅºmy jak wyglÄ…da teraz nasza klasa <code class="highlighter-rouge">Hand</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="no">ORDER_CHECKING</span> <span class="o">=</span> <span class="p">[</span>
    <span class="ss">:royal_flush</span><span class="p">,</span> <span class="ss">:straight_flush</span><span class="p">,</span> <span class="ss">:four_of_a_kind</span><span class="p">,</span> <span class="ss">:full_house</span><span class="p">,</span> <span class="ss">:flush</span><span class="p">,</span>
    <span class="ss">:straight</span><span class="p">,</span> <span class="ss">:three_of_a_kind</span><span class="p">,</span> <span class="ss">:two_pair</span><span class="p">,</span> <span class="ss">:one_pair</span><span class="p">,</span> <span class="ss">:high_card</span><span class="p">,</span> <span class="ss">:none</span>
  <span class="p">].</span><span class="nf">freeze</span>

  <span class="c1"># Poker hand</span>
  <span class="k">class</span> <span class="nc">Hand</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
      <span class="n">array</span><span class="p">,</span>
      <span class="n">order_checking</span> <span class="o">=</span> <span class="no">ORDER_CHECKING</span><span class="p">,</span>
      <span class="n">normalization</span> <span class="o">=</span> <span class="no">CardsNormalization</span>
    <span class="p">)</span>
      <span class="vi">@array</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">sort</span>
      <span class="vi">@order_checking</span> <span class="o">=</span> <span class="n">order_checking</span>
      <span class="vi">@normalization</span> <span class="o">=</span> <span class="n">normalization</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
        <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="n">class_name</span><span class="p">(</span><span class="nb">name</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">class_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="n">class_name</span> <span class="o">=</span> <span class="s1">'Poker::'</span> <span class="o">+</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'_'</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">).</span><span class="nf">join</span>
      <span class="no">Object</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">class_name</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">,</span> <span class="vi">@normalization</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Jestem dumna z tej klasy. JeÅ¼eli chciaÅ‚abyÅ› porÃ³wnaÄ‡ tÄ… klasÄ™ z poczÄ…tkowÄ… implementacjÄ… zajrzyj <a href="https://github.com/womanonrails/poker/blob/55c9ae0ab921f7aa95bb7e47676d87b970a32033/lib/poker/hand.rb" title="Pierwsza wersja kodu klasy Poker" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p>

<h2 id="statystyki-koÅ„cowe">Statystyki koÅ„cowe:</h2>
<ul>
  <li><strong>LOC</strong>  - 37</li>
  <li><strong>LOT</strong>  - 173</li>
  <li><strong>Flog</strong> - 28.0</li>
  <li><strong>Flog total</strong> - 182.4</li>
  <li><strong>Flay</strong> - 0</li>
  <li><strong>Tests</strong> - 145 examples, 0 failures</li>
</ul>

<h1 id="podsumowanie">Podsumowanie</h1>

<p>PodsumujÄ™ teraz to co udaÅ‚o nam siÄ™ osiÄ…gnÄ…Ä‡:</p>

<ul>
  <li>UÅ¼yÅ‚yÅ›my bardziej opisowych nazw w kodzie.</li>
  <li>UproÅ›ciÅ‚yÅ›my kod uÅ¼ywajÄ…c odrobiny meta-programowania.</li>
  <li>StworzyÅ‚yÅ›my maÅ‚e obiekty z maÅ‚Ä… odpowiedzialnoÅ›ciÄ… (wiedzÄ…).</li>
  <li>PrzygotowaÅ‚yÅ›my caÅ‚e zaplecze klas sprawdzajÄ…cych zasady pokera.</li>
</ul>

<h1 id="co-dalej">Co dalej?</h1>

<p>MyÅ›lisz, Å¼e to juÅ¼ koniec refaktoringu? Ja myÅ›lÄ™ o tym w zupeÅ‚nie inny sposÃ³b. Moim zadaniem refaktoring nigdy siÄ™ nie koÅ„czy. To nie znaczy, Å¼e trzeba go robiÄ‡ w nieskoÅ„czonoÅ›Ä‡. Zawsze bÄ™dzie coÅ› do zmiany, do ulepszenia. Z czasem mamy wiÄ™cej informacji o tym jakÄ… logikÄ™ kod ma reprezentowaÄ‡. Wiemy dokÅ‚adnie, co siÄ™ stanie. Na bazie tej wiedzy moÅ¼emy podejmowaÄ‡ kolejne kroki dotyczÄ…ce naszej architektury.</p>

<p>Kiedy teraz patrzÄ™ na ten kod, zmieniÅ‚abym go. ZaczÄ™Å‚abym od powtÃ³rzeÅ„, ktÃ³re jeszcze widzÄ™ w istniejÄ…cych klasach. Pewnie zauwaÅ¼yÅ‚aÅ› teÅ¼, Å¼e czÄ™Å›Ä‡ tych klas jest doÅ›Ä‡ generyczna i wyglÄ…dajÄ… doÅ›Ä‡ podobnie. W nastÄ™pnym etapie usunÄ™Å‚abym te klasy i stworzyÅ‚abym jednÄ… klasÄ™, ktÃ³ra pobieraÅ‚aby nazwÄ™ i logikÄ™ potrzebnej zasady. PÃ³Åºniej zrobiÅ‚abym porzÄ…dek w testach. MoÅ¼e wyciÄ…gnÄ™Å‚abym konfiguracjÄ™ z klasy <code class="highlighter-rouge">Hand</code> do jakiegoÅ› osobnego pliku np. <code class="highlighter-rouge">.yml</code>. A moÅ¼e to konfiguracja mogÅ‚aby przygotowywaÄ‡ kod zwiÄ…zany z zasadami? Czy to za duÅ¼o refaktoringu dla tak maÅ‚ej funkcjonalnoÅ›ci? Pewnie tak, jest to tylko przykÅ‚ad co moÅ¼na zrobiÄ‡ w prawdziwym kodzie by uÅ‚atwiÄ‡ jego rozumienie.</p>

<h1 id="czego-siÄ™-nauczyÅ‚am">Czego siÄ™ nauczyÅ‚am?</h1>
<ul>
  <li>maÅ‚e, czytelne i proste do testowania klasy wiele uÅ‚atwiajÄ…</li>
  <li>przy maÅ‚ych klasach, kod staje siÄ™ bardziej elastyczny (MogÄ™ uÅ¼ywaÄ‡ kodu w rÃ³Å¼ny, czasem nieoczekiwany, sposÃ³b)</li>
  <li>mniej zaleÅ¼noÅ›ci, w Å‚atwy sposÃ³b moÅ¼emy usuwaÄ‡ i dodawaÄ‡ nowe zasady</li>
  <li>jesteÅ›my otwarci na rozszerzanie kodu - nie musimy modyfikowaÄ‡ istniejÄ…cego kodu by dodaÄ‡ nowÄ… logikÄ™, wystarczy stworzyÄ‡ nowÄ… klasÄ™ i przygotowaÄ‡ odpowiedniÄ… konfiguracjÄ™. MoÅ¼emy teÅ¼ pomyÅ›leÄ‡ o konwencji, ktÃ³ra przygotuje konfiguracjÄ™ za nas. Wtedy wszystko dziaÅ‚aÅ‚oby automatycznie.</li>
  <li>To byÅ‚a czysta zabawa!</li>
</ul>

<h1 id="moje-zasady-na-refaktoring">Moje zasady na refaktoring</h1>

<ul>
  <li>po kaÅ¼dym kroku refaktoringu testy muszÄ… przechodziÄ‡</li>
  <li>zacznij od detali a pÃ³Åºniej przejdÅº do bardziej ogÃ³lnego spojrzenia</li>
  <li>nie zmieniaj wszystkiego naraz</li>
  <li>kod powinien byÄ‡ napisany tak, by nie potrzebowaÅ‚ komentarzy, powinien byÄ‡ samo-komentujÄ…cy siÄ™ (sÄ… przypadki gdy warto umieÅ›ciÄ‡ komentarz w kodzie, ale nieczytelny kod nie powinien byÄ‡ do tego wymÃ³wkÄ…)</li>
  <li>narzÄ™dzia takie jak Rubocop lub Reek sÄ… po to, by pomÃ³c; nie wiedzÄ… jednak wszystkiego</li>
  <li>staraj siÄ™ zapobiegaÄ‡ powtÃ³rzeniom w kodzie, jednak pamiÄ™taj, Å¼e lepiej zostawiÄ‡ kod powielony niÅ¼ wyciÄ…gnÄ…Ä‡ zÅ‚Ä… abstrakcjÄ™ (sprawdÅº prezentacjÄ™ Sandi Mezt w bibliografii)</li>
  <li>publiczny interfejs powinien byÄ‡ maÅ‚y</li>
  <li>zawsze myÅ›l o caÅ‚ym swoim systemie, jak duÅ¼y wpÅ‚yw na niego bÄ™dzie miaÅ‚a Twoja zmiana?</li>
  <li>pamiÄ™taj o zasadach takich jak <strong>SOLID</strong></li>
  <li>usuwaj powtÃ³rzenia w mÄ…dry sposÃ³b</li>
  <li>myÅ›l ogÃ³lnie i zawsze pamiÄ™taj o spojrzeniu caÅ‚oÅ›ciowym</li>
</ul>

<h1 id="na-koniec">Na koniec</h1>

<p>ChciaÅ‚abym wspomnieÄ‡ jeszcze o jednej rzeczy na koniec. Przy kaÅ¼dym kroku zamieszczaÅ‚am statystyki (wyniki rÃ³Å¼nych metryk). Nie wiem czy zwrÃ³ciÅ‚aÅ› na to uwagÄ™ ale w trakcie trwania refaktoringu te statystyki byÅ‚y gorsze niÅ¼ na poczÄ…tku. Nigdy nie rezygnuj z refaktoringu z tego powodu. JeÅ¼eli masz dobrÄ… intuicjÄ™ i plan gdzie chcesz byÄ‡ na jego koÅ„cu, krok po kroku kontynuuj swojÄ… podrÃ³Å¼ a zobaczysz efekty.</p>

<p>To wszystko. W tym artykule zamieÅ›ciÅ‚am kilka pomysÅ‚Ã³w na refaktoring. MoÅ¼esz ich uÅ¼ywaÄ‡ caÅ‚kowicie niezaleÅ¼enie. Kroki mogÄ… byÄ‡ wykonywane w innej kolejnoÅ›ci (nie wszystkie, ale czÄ™Å›Ä‡ z pewnoÅ›ciÄ…). Nie musisz teÅ¼ wykorzystywaÄ‡ ich wszystkich. JeÅ¼eli podobaÅ‚ Ci siÄ™ ten artykuÅ‚, podziel siÄ™ swoimi przemyÅ›leniami poniÅ¼ej w komentarzach. Do zobaczenia nastÄ™pnym razem!</p>

<hr />

<h3 id="bibliografia">Bibliografia</h3>

<h4 id="ksiÄ…Å¼ki">KsiÄ…Å¼ki</h4>
<ul>
  <li><a href="https://helion.pl/view/10301k/refukv.htm#format/d" title="Refaktoryzacja. Ulepszanie struktury istniejÄ…cego kodu" target="_blank" rel="nofollow noopener">Refaktoryzacja. Ulepszanie struktury istniejÄ…cego kodu - Martin Fowler</a></li>
  <li><a href="https://helion.pl/view/10301k/czykov.htm#format/d" title="Czysty kod. PodrÄ™cznik dobrego programisty" target="_blank" rel="nofollow noopener">Czysty kod. PodrÄ™cznik dobrego programisty - Robert C. Martin</a></li>
  <li><a href="https://helion.pl/view/10301k/rubywz.htm#format/d" title="Ruby. Wzorce projektowe" target="_blank" rel="nofollow noopener">Ruby. Wzorce projektowe - Russ Olsen</a></li>
  <li><a href="https://helion.pl/view/10301k/tddszt.htm#format/d" title="TDD. Sztuka tworzenia dobrego kodu" target="_blank" rel="nofollow noopener">TDD. Sztuka tworzenia dobrego kodu - Ken Beck</a></li>
  <li><a href="https://helion.pl/view/10301k/pragpv.htm#format/d" title="Pragmatyczny programista. Od czeladnika do mistrza" target="_blank" rel="nofollow noopener">Pragmatyczny programista. Od czeladnika do mistrza - Andrew Hund, David Thomas</a></li>
  <li><a href="https://www.amazon.com/Practical-Object-Oriented-Design-Ruby-Addison-Wesley/dp/0321721330" title="Practical Object-Oriented Design in Ruby: An Agile Primer" target="_blank" rel="nofollow noopener noreferrer">Practical Object-Oriented Design in Ruby: An Agile Primer - Sandi Metz [EN]</a></li>
</ul>

<h4 id="prezentacje-angielskojÄ™zyczne">Prezentacje angielskojÄ™zyczne</h4>
<ul>
  <li><a href="https://www.youtube.com/watch?v=8bZh5LMaSmE" title="All the Little Things by Sandi Metz" target="_blank" rel="nofollow noopener noreferrer">All the Little Things by Sandi Metz</a></li>
  <li><a href="https://www.youtube.com/watch?v=5yX6ADjyqyE" title="Fat Models with Patterns by Bryan Helmkamp" target="_blank" rel="nofollow noopener noreferrer">LA Ruby Conference 2013 Refactoring Fat Models with Patterns by Bryan Helmkamp</a></li>
  <li><a href="https://www.youtube.com/watch?v=OMPfEXIlTVE" title="Nothing is something by Sandi Metz" target="_blank" rel="nofollow noopener noreferrer">Nothing is something by Sandi Metz</a></li>
  <li><a href="https://infinum.co/the-capsized-eight/best-ruby-on-rails-refactoring-talks" title="8 best Ruby on Rails refactoring talks" target="_blank" rel="nofollow noopener noreferrer">Best Ruby on Rails refactoring talks</a></li>
</ul>

                        <br>
                    
                    
                    <div class="entry-tags text-center">

                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="https://womanonrails.com/tags/index.html#Ruby" data-toggle="tooltip" title="Posts tagged with Ruby" rel="tag">Ruby</a>

                    </div>
                    
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        <div class="post-share text-center">
    <p class="light small">
        Share this post
    </p>
    <ul class="social-mini">
        <li>
            <a href="https://twitter.com/intent/tweet?text=&quot;Refaktoring w Ruby krok po kroku - czÄ™Å›Ä‡ 2&quot;%20https://womanonrails.com/refactoring-part2%20via%20&#64;womanonrails"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" data-toggle="tooltip" title="Share on Twitter" itemprop="Twitter">
                <i class="icon-twitter"></i>
            </a>
        </li>
        <li>
            <a  href="https://www.facebook.com/sharer/sharer.php?u=https://womanonrails.com/refactoring-part2"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" data-toggle="tooltip" title="Share on Facebook" itemprop="Facebook">
                <i class="icon-facebook"></i>
            </a>
        </li>
    </ul>
</div>

                        <div class="post-author text-center">
	        <img src="https://womanonrails.com/images/womanonrails-square.svg" alt="Agnieszka Matysek's photo" itemprop="image" class="post-avatar img-circle img-responsive"/>
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="https://schema.org/Person">By <span itemprop="name" class="fn"><a href="https://womanonrails.com/about" title="About Agnieszka Matysek" itemprop="url">Agnieszka Matysek</a></span></h4>
	    <p>Woman, programmer, mentor, speaker, photographer and dancer with passion.</p>
</div>

                        <div id="disqus_thread"></div><!-- /#disqus_thread -->
                    </footer>
            </article>
    </div>
</div>
<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top">

    <div class="inner">
        <div class="container">
          <ul class="social-icons">
            
<li>
  <a href='https://twitter.com/womanonrails' rel='nofollow noopener noreferrer' target='_blank'>
    <span class='svg--twitter'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span>
    <!-- <i class='icon-twitter'></i> -->
  </a>
</li>


            
<li>
  <a href='https://facebook.com/womanonrails' rel='nofollow noopener noreferrer' target='_blank'>
    <span class='svg--facebook'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 264 512"><path d="M76.7 512V283H0v-91h76.7v-71.7C76.7 42.4 124.3 0 193.8 0c33.3 0 61.9 2.5 70.2 3.6V85h-48.2c-37.8 0-45.1 18-45.1 44.3V192H256l-11.7 91h-73.6v229"/></svg></span>
    <!-- <i class='icon-facebook'></i> -->
  </a>
</li>


            
<li>
  <a href='https://stackoverflow.com/users/2885676/womanonrails' rel='nofollow noopener noreferrer' target='_blank'>
    <span class='svg--stackoverflow'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M293.7 300l-181.2-84.5 16.7-36.5 181.3 84.7-16.8 36.3zm48-76L188.2 95.7l-25.5 30.8 153.5 128.3 25.5-30.8zm39.6-31.7L262 32l-32 24 119.3 160.3 32-24zM290.7 311L95 269.7 86.8 309l195.7 41 8.2-39zm31.6 129H42.7V320h-40v160h359.5V320h-40v120zm-39.8-80h-200v39.7h200V360z"/></svg></span>
    <!-- <i class='icon-stack-overflow'></i> -->
  </a>
</li>


            
<li>
  <a href='https://linkedin.com/in/womanonrails' rel='nofollow noopener noreferrer' target='_blank'>
    <span class='svg--linkedin'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z"/></svg></span>
    <!-- <i class='icon-linkedin'></i> -->
  </a>
</li>


            
<li>
  <a href='https://instagram.com/womanonrails' rel='nofollow noopener noreferrer' target='_blank'>
    <span class='svg--linkedin'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg></span>
    <!-- <i class='icon-instagram'></i> -->
  </a>
</li>


            
<li>
  <a href='https://github.com/womanonrails' rel='nofollow noopener noreferrer' target='_blank'>
    <span class='svg--github'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 399.378c0 2.052-2.3 3.693-5.2 3.693-3.3.307-5.6-1.334-5.6-3.693 0-2.05 2.3-3.692 5.2-3.692 3-.307 5.6 1.334 5.6 3.692zm-31.1-4.615c-.7 2.051 1.3 4.41 4.3 5.026 2.6 1.025 5.6 0 6.2-2.052.6-2.05-1.3-4.41-4.3-5.333-2.6-.718-5.5.308-6.2 2.36zm44.2-1.743c-2.9.718-4.9 2.666-4.6 5.025.3 2.051 2.9 3.385 5.9 2.667 2.9-.718 4.9-2.667 4.6-4.718-.3-1.949-3-3.282-5.9-2.974zM244.8 0C106.1 0 0 107.998 0 250.253c0 113.741 69.8 211.073 169.5 245.33 12.8 2.358 17.3-5.744 17.3-12.411 0-6.359-.3-41.435-.3-62.973 0 0-70 15.384-84.7-30.564 0 0-11.4-29.846-27.8-37.538 0 0-22.9-16.102 1.6-15.794 0 0 24.9 2.05 38.6 26.46 21.9 39.59 58.6 28.205 72.9 21.436 2.3-16.41 8.8-27.794 16-34.563-55.9-6.36-112.3-14.667-112.3-113.332 0-28.205 7.6-42.358 23.6-60.41-2.6-6.666-11.1-34.153 2.6-69.64 20.9-6.666 69 27.693 69 27.693 20-5.744 41.5-8.718 62.8-8.718 21.3 0 42.8 2.974 62.8 8.718 0 0 48.1-34.461 69-27.692 13.7 35.589 5.2 62.973 2.6 69.64 16 18.153 25.8 32.307 25.8 60.409 0 98.973-58.9 106.87-114.8 113.332 9.2 8.102 17 23.486 17 47.589 0 34.563-.3 77.332-.3 85.742 0 6.666 4.6 14.769 17.3 12.41 100-34.05 167.8-131.383 167.8-245.124C496 107.998 383.5 0 244.8 0zM97.2 353.738c-1.3 1.026-1 3.385.7 5.333 1.6 1.641 3.9 2.36 5.2 1.026 1.3-1.026 1-3.385-.7-5.333-1.6-1.641-3.9-2.36-5.2-1.026zm-10.8-8.307c-.7 1.333.3 2.974 2.3 4 1.6 1.025 3.6.717 4.3-.718.7-1.334-.3-2.975-2.3-4-2-.616-3.6-.308-4.3.718zm32.4 36.512c-1.6 1.333-1 4.41 1.3 6.359 2.3 2.359 5.2 2.666 6.5 1.025 1.3-1.333.7-4.41-1.3-6.359-2.2-2.358-5.2-2.666-6.5-1.025zm-11.4-15.077c-1.6 1.026-1.6 3.692 0 6.051 1.6 2.36 4.3 3.385 5.6 2.36 1.6-1.334 1.6-4 0-6.36-1.4-2.359-4-3.384-5.6-2.05z"/></svg></span>
    <!-- <i class='icon-github'></i> -->
  </a>
</li>


          </ul>
        <div>
              <a href="/pl/about">Agnieszka Matysek</a>
              &copy; 2020
              &bull; All rights reserved.
            </div>
            <ul class="menu-items">
            
            <li>
                
                    <a href="https://womanonrails.com/"><i class="icon-home"></i></a>&nbsp;&bull;
                
            </li>
            
            <li>
                
                    <a href="https://womanonrails.com/workshops">Programming courses</a>&nbsp;&bull;
                
            </li>
            
            <li>
                
                    <a href="https://womanonrails.com/categories">Categories</a>&nbsp;&bull;
                
            </li>
            
            <li>
                
                    <a href="https://womanonrails.com/tags">Tags</a>&nbsp;&bull;
                
            </li>
            
            <li>
                
                    <a href="https://womanonrails.com/about">About</a>&nbsp;&bull;
                
            </li>
            
            <li><a href="https://womanonrails.com/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="https://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">

                <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
                <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

                <path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path>
                <path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path>

                <path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path>
                <path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path>

                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://womanonrails.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://womanonrails.com/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="https://womanonrails.com/assets/js/waypoints.min.js"></script>
<script type="text/javascript" src="https://womanonrails.com/assets/js/script.js"></script>
<script type='text/javascript'>$(document).ready(function(){$(".time").text(function(a,b){return Math.round(parseFloat(b))})});</script>

<script type="text/javascript">

/*      Slides       */

$("a#slide").click(function(){
    $("#sidebar,body,a#slide,#fade").addClass("slide")
});

$("#fade,#header,#posts-container").click(function(){
    $("#sidebar,body,a#slide,#fade").removeClass("slide")
});

$("a#click-filter").click(function(){
    $("#slide-filter").slideToggle("medium");
    $("#slide-pages").slideOut("medium");
});

$("a#click-pages").click(function(){
    $("#slide-pages").slideToggle("medium");
    $("#slide-filter").slideOut("medium");
});

/*      End-Slides      */

</script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'https://womanonrails.com/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {

     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };

    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });

      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-127731573-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127731573-1');
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'womanonrails'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</body>
</html>
